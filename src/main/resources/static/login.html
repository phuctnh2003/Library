<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sign up/ Log in</title>
    <link rel="stylesheet" href="/login.css">
    <link href="https://fonts.googleapis.com/css?family=Fira+Sans" rel="stylesheet">

</head>
<body>
<div class="form-structor">
    <div class="signup">
        <h2 class="form-title" id="signup"><span>or</span>Sign up</h2>
        <div class="form-holder">
            <input type="text" class="input" placeholder="Username" id="signup-username" required />
            <input type="text" class="input" placeholder="Name" id="signup-name" required />
            <input type="text" class="input" placeholder="Phone" id="signup-phone" required /> <!-- New Phone Field -->

            <select id="signup-role" class="input" required>
                <option value="" disabled selected>Role</option>
                <option value="admin">admin</option>
                <option value="user">user</option>
            </select>

            <input type="password" class="input" placeholder="Password" id="signup-password" required />
        </div>
        <button class="submit-btn" id="signup-btn">Sign up</button>
        <div id="signup-error-message" style="color: red; text-align: center; margin-top: 10px;"></div>
    </div>


    <div class="login slide-up">
        <div class="center">
            <h2 class="form-title" id="login"><span>or</span>Log in</h2>
            <div class="form-holder">
                <input type="text" class="input" placeholder="Username" id="login-username" required />

                <!-- Thêm checkbox để hiển thị/tắt mật khẩu -->
                <div style="position: relative;">
                    <input type="password" class="input" placeholder="Password" id="login-password" required />
                    <input type="checkbox" id="show-password" style="position: absolute; top: 0; right: 0; cursor: pointer;" onclick="togglePassword()">
                </div>
            </div>
            <button class="submit-btn" id="login-btn">Log in</button>
            <!-- Thông báo lỗi cho đăng nhập -->
            <div id="login-error-message" style="color: red; text-align: center; margin-top: 10px;"></div>
        </div>
    </div>
    <div class="version">Version 1.1</div>
</div>



<script>

    function togglePassword() {
            const passwordField = document.getElementById('login-password');
            passwordField.type = passwordField.type === 'password' ? 'text' : 'password';
        }

    const loginBtn = document.getElementById('login');
    const signupBtn = document.getElementById('signup');

    loginBtn.addEventListener('click', (e) => {
    let parent = e.target.parentNode.parentNode;
    Array.from(e.target.parentNode.parentNode.classList).find((element) => {
        if (element !== "slide-up") {
            parent.classList.add('slide-up');
        } else {
            signupBtn.parentNode.classList.add('slide-up');
            parent.classList.remove('slide-up');
        }
    });
    });

    signupBtn.addEventListener('click', (e) => {
    let parent = e.target.parentNode;
    Array.from(e.target.parentNode.classList).find((element) => {
        if (element !== "slide-up") {
            parent.classList.add('slide-up');
        } else {
            loginBtn.parentNode.parentNode.classList.add('slide-up');
            parent.classList.remove('slide-up');
        }
    });
    });

      document.getElementById('signup-btn').addEventListener('click', async () => {
        const username = document.getElementById('signup-username').value.trim();
        const name = document.getElementById('signup-name').value.trim();
        const phone = document.getElementById('signup-phone').value.trim();
        const role = document.getElementById('signup-role').value;
        const password = document.getElementById('signup-password').value.trim();

        const response = await fetch('/auth/register', {
            method: 'POST',
            headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
            body: new URLSearchParams({ username, password, name, role, phone }),
        });

        const message = await response.text();
        if (message.startsWith("404")) {
            document.getElementById("signup-error-message").innerText = "Please fill in all required fields.";
        } else if (message === "400") {
            document.getElementById("signup-error-message").innerText = "Sign up failed, please try again.";
        } else {
            alert("Sign up successful");
            document.getElementById('signup-username').value.trim();
            document.getElementById('signup-name').value.trim();
            document.getElementById('signup-phone').value.trim();
            document.getElementById('signup-role').value;
            document.getElementById('signup-password').value.trim();
            document.getElementById('signup-error-message').innerText = '';
            document.getElementById('login').click();
        }
    });

    document.getElementById('login-btn').addEventListener('click', async () => {
        const username = document.getElementById('login-username').value.trim();
        const password = document.getElementById('login-password').value.trim();
        const response = await fetch('/auth/login', {
            method: 'POST',
            headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
            body: new URLSearchParams({ username, password }),
        });

        const message = await response.text();
        if (message === "404") {
            document.getElementById("login-error-message").innerText = "Please fill in all required fields.";
        } else if (message === "400") {
            document.getElementById("login-error-message").innerText = "Login failed, incorrect username or password.";
        } else {
            try {
                const data = JSON.parse(message);
                sessionStorage.setItem('username', data.username);
                sessionStorage.setItem('name', data.name);
                sessionStorage.setItem('role', data.role);
                sessionStorage.setItem('phone', data.phone);

                if (data.role === "user") {
                    window.location.href = "/user.html";
                } else if (data.role === "admin") {
                    window.location.href = "/admin.html";
                }
            } catch (error) {
                document.getElementById("login-error-message").innerText = "Error occurred while processing the login data.";
            }
        }
    });


</script>
</body>
</html>
